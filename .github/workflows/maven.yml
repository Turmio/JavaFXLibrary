name: Java CI

on: [push, pull_request]

jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
        java-package: jdk+fx 
    - name: Install virtual display and window manager
      run: sudo apt-get update && sudo apt-get install xvfb metacity
    - run: ps aux
    - name: Run tests in virtual display with window manager
      run: xvfb-run --auto-servernum --server-args="-screen 0 1024x768x24" --server-num=1 sh -c "metacity & mvn -B verify"
    - uses: actions/upload-artifact@v1
      if: failure()
      with:
        name: robot-results-linux
        path: target/robotframework-reports/

  build-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v1
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
        java-package: jdk+fx
    - name: Run tests
      run: mvn -B verify
    - uses: actions/upload-artifact@v1
      if: failure()
      with:
        name: robot-results-windows
        path: target/robotframework-reports/
